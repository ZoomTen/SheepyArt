-extends 'base.haml'

-block contents
  -if art
    .main-heading
      %a(href="/user/{{ by.username|e }}", style="text-decoration:none;")
        %img(src="{{ url_for('static', filename='avatar/'+by.avatar) }}" width=50 height=50)
      %h2#heading
        {{ art.title|e }}
      %p#by
        by
        %a(href="/user/{{ by.username }}")
          {{ by.username|e }}
      %p#category
        Category:
        -for i in cat:
          %a(href="{{ url_for('browse.do_browse') + '?cat=' + i.id|e }}") << {{ i.title }}
          -if cat.index(i) != cat|length-1
            |/

    %main#artpage
      %aside
        %strong << Image
        %ul
          %li
            %a(href="{{ url_for('static', filename='uploads/'+art.image) }}")
              Full View
          ; XXX: art: implement favorites and sharing
          ; %li << Add to Favorites
          ; %li << Share

        -if user == art.by
          ; XXX: template/art: implement art editing and deleting. can use upload forms for that.
          %strong << Edit
          %ul
            %li
              %a(href='{{ url_for("upload.do_edit", art_id=art.id) }}') << Edit Art
            %li
              %a#deletthis(href='javascript:void(0);') << Delete Art
        -else
          %strong << More
          %ul
            %li
              %a(href="{{ url_for('gallery.view_gallery', username=by.username|e) }}")
                More from {{by.username|e}}
            %li
              %a(href="{{ url_for('userpage.view_userpage', username=by.username|e) }}")
                See {{by.username|e}}'s profile

      %section#mainart
        ; XXX: art: bigger thumbnails. related: upload.
        %img(src="{{ url_for('static', filename='thumbnail/'+art.thumbnail) }}" height=200)

      %section#artmeta
        #desc
          %p
            %strong << Artist's Comments
            {{ description }}
        #details
          %p
            %strong << Details
            %ul
              ; FIXME: art: make functions for comments, favorites
              %li << Submitted: {{ published }}
              %li << Filesize: {{ filesize }}
              %li << Resolution: {{ resolution[0] }}x{{ resolution[1] }}
              ; %li << Comments: ???
              ; %li << Favorites: {{ favorites }}
              ; %li << In <strong>???</strong> collections
          %p
           %strong << Views
           %ul
             %li << Total: {{ viewcount }}
             %li << Today: ???
             %li << This week: ???
          %p
            %strong << Other (TESTING)
            %ul
              %li << Tags: {{ art.tags|e }}
              %li << NSFW Rating: {{ art.nsfw }}
              %li << License: {{ art.license }}
          ; %p
          ;   %strong << Embed Code<br>
          ;   %input(value="> code here")
          ;   %br
          ;   %strong << Thumbnail Link<br>
          ;   %input(value="> thumbnail link here")
    %script
      | document.getElementById('deletthis').onclick = function(){
      |   var xhr = new XMLHttpRequest();
      |   var delet = confirm('Are you sure you want to delete this?')
      |
      |     xhr.onload = function(){
      |       if (this.status == 200){
      |         window.location.href = xhr.responseURL;
      |        alert("Successfully deleted. You'll be redirected to your user page.");
      |      }
      |      else {
      |        alert("Can't delete the art.");
      |      }
      |    }
      |
      |     if (delet){
      |      xhr.open('POST', '{{ url_for('delete.delete_art') }}', true);
      |       xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      |       xhr.send('art=' + encodeURI({{art.id}}))
      |     }
      |
      |   }

  -else
    .main-heading
      %h2#heading << Art not found

    %main#userpage
      %p
        The art you're looking for cannot be found. Sorry!
